{"version":3,"sources":["../../src/datasource-zabbix/metric-function-editor.directive.js"],"names":[],"mappings":"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","file":"metric-function-editor.directive.js","sourcesContent":["import angular from 'angular';\nimport _ from 'lodash';\nimport $ from 'jquery';\n\n/** @ngInject */\nangular\n  .module('grafana.directives')\n  .directive('metricFunctionEditor', function($compile, templateSrv) {\n\n    var funcSpanTemplate = '<a ng-click=\"\">{{func.def.name}}</a><span>(</span>';\n    var paramTemplate = '<input type=\"text\" style=\"display:none\"' +\n                        ' class=\"input-mini tight-form-func-param\"></input>';\n\n    var funcControlsTemplate =\n       '<div class=\"tight-form-func-controls\">' +\n         '<span class=\"pointer fa fa-arrow-left\"></span>' +\n         '<span class=\"pointer fa fa-question-circle\"></span>' +\n         '<span class=\"pointer fa fa-remove\" ></span>' +\n         '<span class=\"pointer fa fa-arrow-right\"></span>' +\n       '</div>';\n\n    return {\n      restrict: 'A',\n      link: function postLink($scope, elem) {\n        var $funcLink = $(funcSpanTemplate);\n        var $funcControls = $(funcControlsTemplate);\n        var ctrl = $scope.ctrl;\n        var func = $scope.func;\n        var funcDef = func.def;\n        var scheduledRelink = false;\n        var paramCountAtLink = 0;\n\n        function clickFuncParam(paramIndex) {\n          /*jshint validthis:true */\n\n          var $link = $(this);\n          var $input = $link.next();\n\n          $input.val(func.params[paramIndex]);\n          $input.css('width', ($link.width() + 16) + 'px');\n\n          $link.hide();\n          $input.show();\n          $input.focus();\n          $input.select();\n\n          var typeahead = $input.data('typeahead');\n          if (typeahead) {\n            $input.val('');\n            typeahead.lookup();\n          }\n        }\n\n        function scheduledRelinkIfNeeded() {\n          if (paramCountAtLink === func.params.length) {\n            return;\n          }\n\n          if (!scheduledRelink) {\n            scheduledRelink = true;\n            setTimeout(function() {\n              relink();\n              scheduledRelink = false;\n            }, 200);\n          }\n        }\n\n        function inputBlur(paramIndex) {\n          /*jshint validthis:true */\n          var $input = $(this);\n          var $link = $input.prev();\n          var newValue = $input.val();\n\n          if (newValue !== '' || func.def.params[paramIndex].optional) {\n            $link.html(templateSrv.highlightVariablesAsHtml(newValue));\n\n            func.updateParam($input.val(), paramIndex);\n            scheduledRelinkIfNeeded();\n\n            $scope.$apply(function() {\n              ctrl.targetChanged();\n            });\n\n            $input.hide();\n            $link.show();\n          }\n        }\n\n        function inputKeyPress(paramIndex, e) {\n          /*jshint validthis:true */\n          if(e.which === 13) {\n            inputBlur.call(this, paramIndex);\n          }\n        }\n\n        function inputKeyDown() {\n          /*jshint validthis:true */\n          this.style.width = (3 + this.value.length) * 8 + 'px';\n        }\n\n        function addTypeahead($input, paramIndex) {\n          $input.attr('data-provide', 'typeahead');\n\n          var options = funcDef.params[paramIndex].options;\n          if (funcDef.params[paramIndex].type === 'int') {\n            options = _.map(options, function(val) { return val.toString(); });\n          }\n\n          $input.typeahead({\n            source: options,\n            minLength: 0,\n            items: 20,\n            updater: function (value) {\n              setTimeout(function() {\n                inputBlur.call($input[0], paramIndex);\n              }, 0);\n              return value;\n            }\n          });\n\n          var typeahead = $input.data('typeahead');\n          typeahead.lookup = function () {\n            this.query = this.$element.val() || '';\n            return this.process(this.source);\n          };\n        }\n\n        function toggleFuncControls() {\n          var targetDiv = elem.closest('.tight-form');\n\n          if (elem.hasClass('show-function-controls')) {\n            elem.removeClass('show-function-controls');\n            targetDiv.removeClass('has-open-function');\n            $funcControls.hide();\n            return;\n          }\n\n          elem.addClass('show-function-controls');\n          targetDiv.addClass('has-open-function');\n\n          $funcControls.show();\n        }\n\n        function addElementsAndCompile() {\n          $funcControls.appendTo(elem);\n          $funcLink.appendTo(elem);\n\n          _.each(funcDef.params, function(param, index) {\n            if (param.optional && func.params.length <= index) {\n              return;\n            }\n\n            if (index > 0) {\n              $('<span>, </span>').appendTo(elem);\n            }\n\n            var paramValue = templateSrv.highlightVariablesAsHtml(func.params[index]);\n            var $paramLink = $('<a ng-click=\"\" class=\"graphite-func-param-link\">' + paramValue + '</a>');\n            var $input = $(paramTemplate);\n\n            paramCountAtLink++;\n\n            $paramLink.appendTo(elem);\n            $input.appendTo(elem);\n\n            $input.blur(_.partial(inputBlur, index));\n            $input.keyup(inputKeyDown);\n            $input.keypress(_.partial(inputKeyPress, index));\n            $paramLink.click(_.partial(clickFuncParam, index));\n\n            if (funcDef.params[index].options) {\n              addTypeahead($input, index);\n            }\n\n          });\n\n          $('<span>)</span>').appendTo(elem);\n\n          $compile(elem.contents())($scope);\n        }\n\n        function ifJustAddedFocusFistParam() {\n          if ($scope.func.added) {\n            $scope.func.added = false;\n            setTimeout(function() {\n              elem.find('.graphite-func-param-link').first().click();\n            }, 10);\n          }\n        }\n\n        function registerFuncControlsToggle() {\n          $funcLink.click(toggleFuncControls);\n        }\n\n        function registerFuncControlsActions() {\n          $funcControls.click(function(e) {\n            var $target = $(e.target);\n            if ($target.hasClass('fa-remove')) {\n              toggleFuncControls();\n              $scope.$apply(function() {\n                ctrl.removeFunction($scope.func);\n              });\n              return;\n            }\n\n            if ($target.hasClass('fa-arrow-left')) {\n              $scope.$apply(function() {\n                _.move($scope.target.functions, $scope.$index, $scope.$index - 1);\n                ctrl.targetChanged();\n              });\n              return;\n            }\n\n            if ($target.hasClass('fa-arrow-right')) {\n              $scope.$apply(function() {\n                _.move($scope.target.functions, $scope.$index, $scope.$index + 1);\n                ctrl.targetChanged();\n              });\n              return;\n            }\n\n            if ($target.hasClass('fa-question-circle')) {\n              window.open(\"http://graphite.readthedocs.org/en/latest/functions.html#graphite.render.functions.\" + funcDef.name,'_blank');\n              return;\n            }\n          });\n        }\n\n        function relink() {\n          elem.children().remove();\n\n          addElementsAndCompile();\n          ifJustAddedFocusFistParam();\n          registerFuncControlsToggle();\n          registerFuncControlsActions();\n        }\n\n        relink();\n      }\n    };\n\n  });\n"]}