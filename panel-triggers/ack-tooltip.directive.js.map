{"version":3,"sources":["../../src/panel-triggers/ack-tooltip.directive.js"],"names":[],"mappings":"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","file":"ack-tooltip.directive.js","sourcesContent":["import angular from 'angular';\nimport $ from 'jquery';\nimport Drop from 'tether-drop';\n\n/** @ngInject */\nangular\n  .module('grafana.directives')\n  .directive('ackTooltip', function($sanitize, $compile) {\n    let buttonTemplate = '<a bs-tooltip=\"\\'Acknowledges ({{trigger.acknowledges.length}})\\'\"' +\n                          '<i ng-class=\"' +\n                            \"{'fa fa-comments': trigger.acknowledges.length, \" +\n                            \"'fa fa-comments-o': !trigger.acknowledges.length, \" +\n                          '}\"></i></a>';\n\n    return {\n      scope: {\n        ack: \"=\",\n        trigger: \"=\",\n        onAck: \"=\",\n        context: \"=\"\n      },\n      link: function(scope, element) {\n        let acknowledges = scope.ack;\n        let $button = $(buttonTemplate);\n        $button.appendTo(element);\n\n        $button.click(function() {\n          let tooltip = '<div>';\n\n          if (acknowledges && acknowledges.length) {\n            tooltip += '<table class=\"table\"><thead><tr>' +\n                        '<th class=\"ack-time\">Time</th>' +\n                        '<th class=\"ack-user\">User</th>' +\n                        '<th class=\"ack-comments\">Comments</th>' +\n                        '</tr></thead><tbody>';\n            for (let ack of acknowledges) {\n              tooltip += '<tr><td>' + ack.time + '</td>' +\n                         '<td>' + ack.user + '</td>' +\n                         '<td>' + ack.message + '</td></tr>';\n            }\n            tooltip += '</tbody></table>';\n          } else {\n            tooltip += 'Add acknowledge';\n          }\n\n          let addAckButtonTemplate = '<div class=\"ack-add-button\">' +\n                                       '<button id=\"add-acknowledge-btn\"' +\n                                         'class=\"btn btn-mini btn-inverse gf-form-button\">' +\n                                         '<i class=\"fa fa-plus\"></i>' +\n                                       '</button></div>';\n          tooltip += addAckButtonTemplate;\n          tooltip += '</div>';\n\n          let drop = new Drop({\n            target: element[0],\n            content: tooltip,\n            position: \"bottom left\",\n            classes: 'drop-popover ack-tooltip',\n            openOn: 'hover',\n            hoverCloseDelay: 500,\n            tetherOptions: {\n              constraints: [{to: 'window', pin: true, attachment: \"both\"}]\n            }\n          });\n\n          drop.open();\n          drop.on('close', closeDrop);\n\n          $('#add-acknowledge-btn').on('click', onAddAckButtonClick);\n\n          function onAddAckButtonClick() {\n            let inputTemplate = '<div class=\"ack-input-group\">' +\n                                  '<input type=\"text\" id=\"ack-message\">' +\n                                  '<button id=\"send-ack-button\"' +\n                                    'class=\"btn btn-mini btn-inverse gf-form-button\">' +\n                                    'Acknowledge </button>' +\n                                  '<button id=\"cancel-ack-button\"' +\n                                    'class=\"btn btn-mini btn-inverse gf-form-button\">' +\n                                    'Cancel' +\n                                  '</button></input></div>';\n\n            let $input = $(inputTemplate);\n            let $addAckButton = $('.ack-tooltip .ack-add-button');\n            $addAckButton.replaceWith($input);\n            $('.ack-tooltip #cancel-ack-button').on('click', onAckCancelButtonClick);\n            $('.ack-tooltip #send-ack-button').on('click', onAckSendlButtonClick);\n          }\n\n          function onAckCancelButtonClick() {\n            $('.ack-tooltip .ack-input-group').replaceWith(addAckButtonTemplate);\n            $('#add-acknowledge-btn').on('click', onAddAckButtonClick);\n          }\n\n          function onAckSendlButtonClick() {\n            let message = $('.ack-tooltip #ack-message')[0].value;\n            let onAck = scope.onAck.bind(scope.context);\n            onAck(scope.trigger, message).then(() => {\n              closeDrop();\n            });\n          }\n\n          function closeDrop() {\n            setTimeout(function() {\n              drop.destroy();\n            });\n          }\n\n        });\n\n        $compile(element.contents())(scope);\n      }\n    };\n  });\n"]}